# Pentesting (kali)

- [Pentesting (kali)](#pentesting-kali)
  - [Installation](#installation)
  - [Security notes](#security-notes)
  - [Change root password](#change-root-password)
  - [Create unpriviliged user](#create-unpriviliged-user)
  - [Update and upgrade](#update-and-upgrade)
  - [New SSH keys](#new-ssh-keys)

## Installation

Kali [installation per netinstaller iso](https://www.kali.org/downloads/) in [KVM](Installation-kvm.md) went without a glitch.

## Security notes

When installing kali in a virtual machine from a premade image, there are several components that are not installed, outdated or set with insecure default settings. This is true to a lesser extent for the .iso's also.

* Offensive Security make these files every few months or so. Kali is outdated (read "vulnerable") when it is installed. 
* All machines have the same settings by default. Root account present, same password, same outdated SSH keys etcetera. A sword of Damocles ...

## Change root password

Kali Linux comes with password `toor` for user `root` by default. Change the password.

    # passwd [new password]

## Create unpriviliged user

On a sidenote, use `root` as little as possible because `root` can do just about anything including corrupting the files and damaging the machine. Create an unprivileged user and add user to sudoers.

    # adduser [username]

    # usermod -a -G sudo [username]

The option -a means to add and ‘-G sudo’ means to add the user to the sudo group.

Add `[username]` user to the sudoers file:

    # adduser [username] sudo

Switch to `[username]`

    # su [username]

    $ ...

## Update and upgrade

Update and upgrade immediately. And `apt dist-upgrade`.

    $ sudo apt update
    $ sudo apt upgrade
    $ sudo apt dist-upgrade

## New SSH keys

Everyone who downloaded and installed the same image have the same [SSH keys](../ssh.md). Create a new pair.

Create a folder `old_keys` in the `/etc/ssh` directory and move the old keys into that folder.

    $ sudo mkdir /etc/ssh/old_keys
    $ sudo mv ssh_host_* /etc/ssh/old_keys

Check with:

    $ ls /etc/ssh/old_keys

Create new pair:

    $ sudo dpkg-reconfigure openssh-server

Ignore warning message or a message about a static unit. 

Check the MD5 hashes of the new keys and compare them to the default ones moved into `old_keys`.

    $ md5sum /etc/ssh/ssh_host_*

and

    $ md5sum /etc/ssh/old_keys/ssh_host_*

If different, new SSH keys have been created.